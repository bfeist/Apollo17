<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xml:lang="en" lang="en" dir="ltr">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="template" />
	<link rel="shortcut icon" href="/favicon.ico" />
	<link rel="copyright" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />

	<title>TOC</title>
	<meta name="robots" content="index,follow" />
	<style type="text/css" media="screen,projection"></style>
	<link rel="stylesheet" type="text/css" href="styles.css" />
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script>
		lasttimeid = '';
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);        

        // This function creates an <iframe> (and YouTube player) after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '520',
                width: '720',
                videoId: 'yGcmH96w-Fg',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // The API will call this function when the video player is ready.
        function onPlayerReady(event) {
		
			//poll for mission time
			setInterval(function () {
				var totalSec = player.getCurrentTime();
				var hours = parseInt(totalSec / 3600) % 24;
				var minutes = parseInt(totalSec / 60) % 60;
				var seconds = totalSec % 60;
				seconds = Math.floor(seconds);

				var result = (hours < 10 ? "00" + hours : hours < 100 ? "0" + hours : hours) + ":" +
					(minutes < 10 ? "0" + minutes : minutes) + ":" +
					(seconds < 10 ? "0" + seconds : seconds);

				timer.innerText = result;

				var timeid = "timeid" +
					(hours < 10 ? "00" + hours : hours < 100 ? "0" + hours : hours) +
					(minutes < 10 ? "0" + minutes : minutes) +
					(seconds < 10 ? "0" + seconds : seconds);

				scrollToTimeID(timeid);

			}, 500); //polling frequency in milliseconds		
			
            event.target.playVideo();
        }

        // The API calls this function when the player's state changes.
        // The function indicates that when playing a video (state=1)
        var done = false;

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING && !done) {
                //setTimeout(seekTo10Min, 5000);				
				player.seekTo(0, true);
                done = true;
            }
        }

        function stopVideo() {
            player.stopVideo();
        }

        function seekTo10Min() {
            player.seekTo(600, true);
			scrollToTimeID('timeid0001002');
			
			//$('#iFrameTranscript').contents().scrollTop($('#iFrameTranscript').contents().find('#timeid0001002').offset().top);
			//$('#timeid0001002').goTo();		
        }
		
		$.fn.exists = function () {
			return this.length !== 0;
		}
		
		function scrollToTimeID(timeid) {
			//console.log ('#' + timeid + ' - ' + $('#iFrameTranscript').contents().find('#' + timeid).length);			
			if ($('#iFrameTranscript').contents().find('#' + timeid).exists()) {
				
				//reset background color of last line
				if (lasttimeid != '') {
					$('#iFrameTranscript').contents().find('#' + lasttimeid).css("background-color","#FFFFFF");
				}
			
				var content = $('#iFrameTranscript').contents().find('#' + timeid);
				var topCoord = content.offset().top - 50;
				content.css("background-color","#DDDDDD");
				$('#iFrameTranscript').contents().find('body').animate({ scrollTop: topCoord }, 300);
				//$('#iFrameTranscript').contents().scrollTop(topCoord);
				lasttimeid = timeid;
			}
		}

	//	$(document).ready(function() {
	//		setTimeout(function() {
	//			var $contents = $('#iFrameTranscript').contents();
	//			$contents.scrollTop($contents.find('#timeid0001002').offset().top);
	//		}, 3000); // ms = 3 sec
	//		return this; // for chaining...
	//	});
		
    </script>
</head>

<body>

    <!--<div id="topBar"> <a href ="#" onclick="load_toc()"> Load TOC </a> </div> -->
    <div style="float: left; width: 50%">
        <iframe src="TOC.html" style="border:1px #000000 none;" id="iFrameTOC" scrolling="yes" frameborder="1" marginheight="5px" marginwidth="5px" height="400px" width="100%"></iframe>
    </div>
    <div style="float: right; width: 640px;" id="player">
	</div>
	<div id="timer">00</div>
	<div id="debug" onclick="seekTo10Min()">Skip to 10:00</div>
    <div style="width: 100%;">
        <iframe src="./segments/0000000_Lift-off(Rangezero=342053300GMT).html" style="border:1px #000000 none;" id="iFrameTranscript" scrolling="yes" frameborder="1" marginheight="5px" marginwidth="5px" height="470px" width="100%"></iframe>
    </div>

</body>
</html>